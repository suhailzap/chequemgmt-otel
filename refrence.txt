# OR Install OpenJDK 21 (latest LTS)
sudo apt install openjdk-21-jdk -y


    Create missing directories: Sometimes, these errors occur because directories don't exist.

sudo mkdir -p /usr/share/man/man1

    Reconfigure the packages:

sudo dpkg --configure -a

    Fix broken dependencies:

sudo apt -f install

After that, try reinstalling OpenJDK:

sudo apt install --reinstall openjdk-21-jdk


sudo apt install maven -y


mvn clean package -DskipTests
wget https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/latest/download/opentelemetry-javaagent.jar

java -javaagent:./opentelemetry-javaagent.jar -Dotel.service.name=java-app -jar ./target/chequebackend-0.0.1-SNAPSHOT.jar

java -jar target/chequebackend-0.0.1-SNAPSHOT.jar

PSQL:
sudo apt install postgresql -y
sudo systemctl start postgresql
sudo -u postgres psql

    Create the database mydb if it doesn't exist:

CREATE DATABASE mydb;

    Create the user kodekloud with password kkpass123:

CREATE USER kodekloud WITH PASSWORD 'kkpass123';

    Grant the user access to the database:

GRANT ALL PRIVILEGES ON DATABASE mydb TO kodekloud;

sudo -u postgres psql -d mydb

CREATE TABLE IF NOT EXISTS cheque (
  cheque_no VARCHAR(20) PRIMARY KEY,
  approval_granted BOOLEAN NOT NULL
);
GRANT ALL PRIVILEGES ON TABLE cheque TO kodekloud;


PYTHON:

sudo apt install python3 python3-pip python3-venv -y
# Create virtual environment
python3 -m venv myenv

# Activate it
source myenv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt


# Deactivate when done
deactivate











Let's now set up the application for auto-instrumentation.

First, create a virtual environment to run the frontend code:

python3 -m venv venv
source venv/bin/activate

Navigate to the frontend folder:

cd /root/code/chequemgmt/frontend

Install the required libraries within the frontend folder:

pip install -r requirements.txt

Then, install the opentelemetry-distro, opentelemetry-exporter-otlp, and other required libraries:

pip install \
  opentelemetry-api \
  opentelemetry-sdk \
  opentelemetry-exporter-otlp \
  opentelemetry-instrumentation-flask \
  opentelemetry-instrumentation-requests \
  opentelemetry-distro

Let's now have opentelemetry scan our code and find all the packages that support instrumentation and automatically install their respective instrumentation libraries:

opentelemetry-bootstrap -a install

Inside venv/lib/python3.12/site-packages, verify that the instrumentation libraries for Flask and requests have been installed.

For example, for Flask, the opentelemetry_instrumentation_flask-xx package should have been automatically installed.

Export the following environment variables before you start with the application in the next task:

export OTEL_PYTHON_AUTO_INSTRUMENTATION_ENABLED=true
export OTEL_EXPORTER_OTLP_INSECURE=true
export OTEL_TRACES_SAMPLER=always_on

Start the frontend Python application with the following configuration to enable auto-instrumentation:

    Trace Exporters: console, otlp
    Metrics Exporter: console
    Service Name: frontend-service
    Exporter OTLP endpoint: localhost:4317


Note: Ensure that it keeps on running! For other tasks, navigate to a new terminal.

First, navigate to the directory frontend:

cd /root/code/chequemgmt/frontend

Then, run the following command:

opentelemetry-instrument \
      --traces_exporter console,otlp \
    --metrics_exporter console \
      --exporter_otlp_endpoint=localhost:4317 \
      --service_name=frontend-service \
      python3 app.py


mkdir -p ./loki-storage/wal ./loki-storage/index ./loki-storage/chunks
sudo chown -R 10001:10001 ./loki-storage
sudo chmod -R 775 ./loki-storage
